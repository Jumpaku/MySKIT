<!DOCTYPE html>
<html lang="ja">
	<head>
	<meta charset="UTF-8">
	<title>Myskit by Jumpaku</title>
		<script>
			var canvas;
			var context;
			var isTouchable = false;
			var prev;
			var next;

			function drawLine(){
				if(prev && next){
					context.beginPath();
					context.moveTo(prev.x, prev.y);
					context.lineTo(next.x, next.y);
					context.closePath();
					context.stroke();
				}
			}

			function addPoint(e){
				prev = next;
				next = isTouchable ? {
					x: e.touches[0].clientX,
					y: e.touches[0].clientY,
				} : {
					x: e.clientX,
					y: e.clientY,
				};
			}

			function start(){
				canvas = document.getElementById("maincanvas");
				context = canvas.getContext("2d");
				var addLine = function(e){
					e.preventDefault();
					addPoint(e);
					drawLine();
				};
				var down;
				var up;
				var move;

				if ((navigator.userAgent.indexOf('iPhone') > 0 && navigator.userAgent.indexOf('iPad') == -1) ||
				navigator.userAgent.indexOf('iPod') > 0 ||
			 	navigator.userAgent.indexOf('Android') > 0) {
			 		isTouchable = true;
				}

				if(isTouchable){
					down = "touchstart";
					up = "touchmove";
					move = "touchend";
				}
				else{
					down = "mousedown";
					up = "mouseup";
					move = "mousemove";
				}
			
				var startDraw = function(){
					canvas.removeEventListener(down, startDraw);
					canvas.addEventListener(move, addLine);
					canvas.addEventListener(up, function(){
						canvas.removeEventListener(move, addLine);
						prev = null;
						next = null;
						canvas.addEventListener(down, startDraw);
					});
				}
				canvas.addEventListener(down, startDraw);
			}
		</script>
	</head>
	<body onload="start();">

		<canvas id="maincanvas" height="480" width="640"></canvas>

	</body>
</html>
