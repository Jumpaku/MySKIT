<!DOCTYPE html>
<html lang="ja">
	<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
	<title>Myskit by Jumpaku</title>
		<script>
			var canvas;
			var context;
			var isTouchable = false;
			var prev;
			var next;

			function drawLine(){
				if(prev && next){
					context.beginPath();
					context.moveTo(prev.x, prev.y);
					context.lineTo(next.x, next.y);
					context.closePath();
					context.stroke();
				}
			}

			function addPoint(e){
				prev = next;
				next = isTouchable ? {
					x: e.targetTouches[0].clientX,
					y: e.targetTouches[0].clientY,
				} : {
					x: e.clientX,
					y: e.clientY,
				};
			}

			function start(){
				canvas = document.getElementById("maincanvas");
				context = canvas.getContext("2d");
				var addLine = function(e){
					e.preventDefault();
					addPoint(e);
					drawLine();
				};
				var down;
				var up;
				var move;

				if ((navigator.userAgent.indexOf('iPhone') > -1 && navigator.userAgent.indexOf('iPad') == -1) ||
					navigator.userAgent.indexOf('iPod') > -1 ||
				 	navigator.userAgent.indexOf('Android') > -1) {
				 	
				 	isTouchable = true;
				}

				if(isTouchable){
					down = "touchstart";
					up = "touchmove";
					move = "touchend";
				}
				else{
					down = "mousedown";
					up = "mouseup";
					move = "mousemove";
				}
			
				var startDraw = function(){
					canvas.removeEventListener(down, startDraw);
					canvas.addEventListener(move, addLine);
					canvas.addEventListener(up, function(){
						canvas.removeEventListener(move, addLine);
						prev = null;
						next = null;
						canvas.addEventListener(down, startDraw);
					});
				}
				canvas.addEventListener(down, startDraw);
			}
		</script>
		<script>
			function test(){
				var someElement = document.getElementById("maincanvas");
				someElement.addEventListener('touchmove', function(e) {
					// Iterate through the list of touch points that changed
					// since the last event and print each touch point's identifier.
					for (var i=0; i < e.changedTouches.length; i++) {
						alert("changedTouches[" + i + "].identifier = " + e.changedTouches[i].identifier);
					} 
				}, false);
			}
		</script>
	</head>
	<body onload="test();//start();//">

		<canvas id="maincanvas" height="200" width="200"></canvas>

	</body>
</html>
